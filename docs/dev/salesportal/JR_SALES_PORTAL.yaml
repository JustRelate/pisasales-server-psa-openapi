openapi: 3.0.3

info:
  version: '8.3'
  title: Sales portal API
  description: Endpoints to be used by the Scrivito sales portal. All endpoints require an IAM authorization.

paths:
  /salesportal/contact:
    get:
      summary: Get information about contacts
      description: Returns a list of all contacts
      tags:
        - contact
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/contacts'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/contact/{id}:
    get:
      summary: Get information about a single contact
      description: Returns contact data.
      tags:
        - contact
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/contact'
        '400':
          $ref: '#/components/responses/error_invalid_id'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/whoami:
    get:
      summary: Get information about the authenticated user
      description: Returns contact data of the user
      tags:
        - contact
      parameters:
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/whoami'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/company:
    get:
      summary: Fetch all companies
      description: Searches all companies. Additional queries can be set by simply adding the field name as query parameter.
      tags:
        - company
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
        - name: persons
          in: query
          description: Comma separated list of person IDs. Finds all companies which are associated to the given persons.
          example: DA8FA0F7483D467B905207A0CAB8D1DE
          schema:
            type: string
      responses:
        '200':
          $ref: '#/components/responses/companies'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a company
      description: This will create a new company
      tags:
        - company
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The company data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/company_base'
      responses:
        '201':
          $ref: '#/components/responses/company'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'

  /salesportal/company/{id}:
    get:
      summary: Fetch a single company
      description: Searches the _id of a company
      tags:
        - company
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/company'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
    patch:
      summary: Update a company
      description: This will update an existing company
      tags:
        - company
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The company data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/company_base'
      responses:
        '200':
          $ref: '#/components/responses/company'
        '400':
          $ref: '#/components/responses/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    delete:
      summary: Delete a company
      description: Searches the _id of a company and deletes the record
      tags:
        - company
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The company was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '409':
          description: The company could not be deleted due to a conflict        
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                    example: 'relation.check_failed'
                  error:
                    type: string
                    example: 'relation count exceeds delete check'
                  details:
                    type: object
                    properties:
                      count:
                        type: string
                        example: '1'
                      relation:
                        type: string
                        example: 'Main company'

  /salesportal/person:
    get:
      summary: Fetch all persons
      description: Searches all persons. Additional queries can be set by simply adding the field name as query parameter.
      tags:
        - person
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
        - name: companies
          in: query
          description: Comma separated list of company IDs. Finds all persons which are associated to the given companies.
          example: 44AB4B88EBD34608B0E4A81C1DA1D85B
          schema:
            type: string
      responses:
        '200':
          $ref: '#/components/responses/persons'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a person
      description: This will create a new person
      tags:
        - person
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The person data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/person_base'
      responses:
        '201':
          $ref: '#/components/responses/person'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'

  /salesportal/person/{id}:
    get:
      summary: Fetch a single person
      description: Searches the _id of a person
      tags:
        - person
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/person'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
    patch:
      summary: Update a person
      description: This will update an existing person
      tags:
        - person
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The person data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/person_base'
      responses:
        '200':
          $ref: '#/components/responses/person'
        '400':
          $ref: '#/components/responses/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    delete:
      summary: Delete a person
      description: Searches the _id of a person and deletes the record
      tags:
        - person
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The person was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '409':
          description: The person could not be deleted due to a conflict        
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                    example: 'relation.check_failed'
                  error:
                    type: string
                    example: 'relation count exceeds delete check'
                  details:
                    type: object
                    properties:
                      count:
                        type: string
                        example: '1'
                      relation:
                        type: string
                        example: 'quote'

  /salesportal/address:
    get:
      summary: Get information about addreses
      description: Returns a list of all addresses
      tags:
        - address
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/addresses'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create an address
      description: This will create a new address
      tags:
        - address
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The address data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/address_base'
      responses:
        '201':
          $ref: '#/components/responses/address'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'

  /salesportal/address/{id}:
    get:
      summary: Fetch a single address
      description: Searches the _id of an address
      tags:
        - address
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/address'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
    patch:
      summary: Update an address
      description: This will update an existing address
      tags:
        - address
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The address data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/address_base'
      responses:
        '200':
          $ref: '#/components/responses/address'
        '400':
          $ref: '#/components/responses/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    delete:
      summary: Delete an address
      description: Searches the _id of an address and deletes the record
      tags:
        - address
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The address was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/project:
    get:
      summary: Get information about projects
      description: Returns a list of all projects
      tags:
        - project
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/projects'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/project/{id}:
    get:
      summary: Get information about a single project
      description: Returns project data.
      tags:
        - project
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/project'
        '400':
          $ref: '#/components/responses/error_invalid_id'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/opportunity:
    get:
      summary: Fetch all opportunities
      description: Searches all opportunities. Additional queries can be set by simply adding the field name as query parameter.
      tags:
        - opportunity
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/opportunities'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/opportunity/{id}:
    get:
      summary: Fetch a single opportunity
      description: Searches the _id of an opportunity
      tags:
        - opportunity
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/opportunity'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/quote:
    get:
      summary: Fetch all quotes
      description: Searches all quotes. Additional queries can be set by simply adding the field name as query parameter.
      tags:
        - quote
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/quotes'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/quote/{id}:
    get:
      summary: Fetch a single quote
      description: Searches the _id of an quote
      tags:
        - quote
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/quote'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/order:
    get:
      summary: Fetch all orders
      description: Searches all orders. Additional queries can be set by simply adding the field name as query parameter.
      tags:
        - order
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/orders'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/order/{id}:
    get:
      summary: Fetch a single order
      description: Searches the _id of an order
      tags:
        - order
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/order'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/ticket:
    get:
      summary: Get information about tickets
      description: Returns a list of all tickets
      tags:
        - ticket
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/tickets'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a ticket
      description: This will create a new ticket
      tags:
        - ticket
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The ticket data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ticket_base'
      responses:
        '201':
          $ref: '#/components/responses/ticket'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'

  /salesportal/ticket/{id}:
    get:
      summary: Get information about a single ticket
      description: Returns ticket data.
      tags:
        - ticket
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/ticket'
        '400':
          $ref: '#/components/responses/error_invalid_id'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
    patch:
      summary: Update a ticket
      description: This will update an existing ticket
      tags:
        - ticket
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The ticket data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ticket_base'
      responses:
        '200':
          $ref: '#/components/responses/ticket'
        '400':
          $ref: '#/components/responses/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    delete:
      summary: Delete a ticket
      description: Searches the _id of a ticket and deletes the record
      tags:
        - ticket
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The ticket was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/activity:
    get:
      summary: Fetch all activities
      description: Searches all activities. Additional queries can be set by simply adding the field name as query parameter.
      tags:
        - activity
      parameters:
        - $ref: '#/components/parameters/ids_query'
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/search_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/language_query'
        - $ref: '#/components/parameters/count_query'
        - name: contacts
          in: query
          description: Comma separated list of contact IDs. Finds all activities which are associated to the given contacts.
          example: DA8FA0F7483D467B905207A0CAB8D1DE
          schema:
            type: string
        - name: projects
          in: query
          description: Comma separated list of project IDs. Finds all activities which are associated to the given project.
          example: DA8FA0F7483D467B905207B0CAB8D1DE
          schema:
            type: string
      responses:
        '200':
          $ref: '#/components/responses/activities'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a new activity
      description: This will create a new activity
      tags:
        - activity
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The activity data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/activity_base'
      responses:
        '201':
          $ref: '#/components/responses/activity'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'

  /salesportal/activity/{id}:
    get:
      summary: Fetch a single activity
      description: Searches the _id of an activity
      tags:
        - activity
      parameters:
        - $ref: '#/components/parameters/id_path'
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/activity'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
    patch:
      summary: Update an activity
      description: This will update an existing activity
      tags:
        - activity
      parameters:
        - $ref: '#/components/parameters/language_query'
      requestBody:
        description: The activity data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/activity_base'
      responses:
        '200':
          $ref: '#/components/responses/activity'
        '400':
          $ref: '#/components/responses/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    delete:
      summary: Delete an activity
      description: Searches the _id of an activity and deletes the record
      tags:
        - activity
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The activity was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/message:
    get:
      summary: Fetch all messages
      description: Searches all messages that belong to a certain object (like a project)
      tags:
        - message
      parameters:
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/order_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/count_query'
        - name: subjectId
          in: query
          description: ID of the associated object
          required: true
          example: DDF8F474C125466DAB2A4937D5945E11
          schema:
            type: string
      responses:
        '200':
          $ref: '#/components/responses/messages'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Post a new message
      description: Post a new message
      tags:
        - message
      requestBody:
        description: The message data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/message_post'
      responses:
        '201':
          $ref: '#/components/responses/message'
        '400':
          $ref: '#/components/responses/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
  /salesportal/message/{id}:
    get:
      summary: Fetch a single message
      description: Searches the _id of a message
      tags:
        - message
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '200':
          $ref: '#/components/responses/message'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/activity-contact:
    get:
      summary: Fetch all activity-contact-relations
      description: Searches all relations
      tags:
        - relation
      parameters:
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/activity-contacts'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a new activity-contact-relation
      description: This will create a new relation between an activity and a contact (person or company)
      tags:
        - relation
      requestBody:
        description: The relation data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/activity-contact_base'
      responses:
        '201':
          $ref: '#/components/responses/activity-contact'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    
  /salesportal/activity-contact/{id}:
    delete:
      summary: Delete an activity-contact-relation
      description: Searches the _id of a relation and deletes the record
      tags:
        - relation
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The relation was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/company-person:
    get:
      summary: Fetch all company-persons-relations
      description: Searches all employee relations
      tags:
        - relation
      parameters:
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/company-persons'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a new company-person-relation
      description: This will create a new relation between a company and a person (employee)
      tags:
        - relation
      requestBody:
        description: The relation data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/company-person_base'
      responses:
        '201':
          $ref: '#/components/responses/company-person'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    
  /salesportal/company-person/{id}:
    delete:
      summary: Delete a company-person-relation
      description: Searches the _id of a relation and deletes the record
      tags:
        - relation
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The relation was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/address-contact:
    get:
      summary: Fetch all address-contact-relations
      description: Searches all relations
      tags:
        - relation
      parameters:
        - $ref: '#/components/parameters/continuation_query'
        - $ref: '#/components/parameters/limit_query'
        - $ref: '#/components/parameters/count_query'
      responses:
        '200':
          $ref: '#/components/responses/address-contacts'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
    post:
      summary: Create a new address-contact-relation
      description: This will create a new relation between an address and a contact
      tags:
        - relation
      requestBody:
        description: The relation data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/address-contact_base'
      responses:
        '201':
          $ref: '#/components/responses/address-contact'
        '400':
          description: The submitted data had errors
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/error_invalid_id'
                  - $ref: '#/components/schemas/error_missing_data'
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '422':
          $ref: '#/components/responses/error_data_validation_failed'
    
  /salesportal/address-contact/{id}:
    delete:
      summary: Delete a address-contact-relation
      description: Searches the _id of a relation and deletes the record
      tags:
        - relation
      parameters:
        - $ref: '#/components/parameters/id_path'
      responses:
        '204':
          description: The relation was deleted
        '403':
          $ref: '#/components/responses/error_authentication_failed'
        '404':
          $ref: '#/components/responses/error_record_not_found'

  /salesportal/binary-access-token/{id}:
    get:
      summary: Request a token for accessing binary data
      description: Returns an URL containing a token that is valid for a limited time and grants access to a single record
      tags:
        - binary-access
      parameters:
        - name: id
          in: path
          description: binary ID
          required: true
          schema:
            type: string
      responses:
        '200':
          $ref: '#/components/responses/binary-access-token'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

  /salesportal/binary-access/{token}:
    get:
      summary: Get the binary data for an access token
      description: No IAM is needed for this endpoint
      tags:
        - binary-access
      parameters:
        - name: token
          in: path
          description: binary access token
          required: true
          schema:
            type: string
      responses:
        '200':
          description: binary data
          content:
            application/octet-stream: 
              schema:
                type: string
                format: binary
          headers:
            Content-Type:
              schema:
                type: string
                description: MIME type
                example: image/jpg
            Content-Length:
              schema:
                type: integer
                description: Length in bytes
                example: 22192
            Content-Disposition:
              schema:
                type: string
                example: attachment; filename="screenshot.jpg"
        '401':
          description: the token is invalid or expired

  /salesportal/schema:
    get:
      summary: Fetch schemas
      description: Returns the schema of all entities
      tags:
        - schema
      parameters:
        - name: name
          in: query
          description: Search for a single schema by name
          example: company
          schema:
            type: string
        - $ref: '#/components/parameters/language_query'
      responses:
        '200':
          $ref: '#/components/responses/schema-list'
        '403':
          $ref: '#/components/responses/error_authentication_failed'

components:
  ########################################################################
  # parameters
  ########################################################################
  parameters:
    id_path:
      in: path
      name: id
      description: ID of the record
      required: true
      schema:
        type: string

    continuation_query:
      in: query
      name: _continuation
      description: continuation key that was returned with the last result list
      schema:
        type: string

    search_query:
      in: query
      name: _search
      description: Full text (EUREKA) search term
      schema:
        type: string
        
    order_query:
      in: query
      name: _order
      description: list of fields that should be used for ordering
      example: createdAt.desc,name.asc
      schema:
        type: string
        
    limit_query:
      in: query
      name: _limit
      description: maximum number of records to return. if the maximum is reached a continuation key will be in the response. the default value is 100
      example: 10
      schema:
        type: number

    language_query:
      in: query
      name: _language
      description: Language to be used for the localized data fields (e.g. GER or ENG). Overwrites the Accept-Language header.
      example: GER
      schema:
        type: string

    count_query:
      in: query
      name: _count
      description: count the total number of results available
      example: false
      schema:
        type: boolean

    ids_query:
      in: query
      name: ids
      description: Search for multiple IDs. Values are separated by a comma
      example: 8065A97B2E1843E292CAAC1480EBAD84,F143C455A23E4A1B991D0DF2726755A6
      schema:
        type: string

  ########################################################################
  # responses
  ########################################################################
  responses:
    contact:
      description: contact data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/contact'

    contacts:
      description: a list of contacts
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/contacts'
            
    whoami:
      description: current user
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/whoami'

    company:
      description: company data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/company'

    companies:
      description: a list of companies
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/companies'

    person:
      description: person data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/person'

    persons:
      description: a list of persons
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/persons'

    address:
      description: address data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/address'

    addresses:
      description: a list of addresses
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/addresses'

    project:
      description: project data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/project'

    projects:
      description: a list of projects
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/projects'

    ticket:
      description: ticket data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ticket'

    tickets:
      description: a list of tickets
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/tickets'

    opportunity:
      description: opportunity data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/opportunity'

    opportunities:
      description: a list of opportunities
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/opportunities'

    quote:
      description: quote data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/quote'

    quotes:
      description: a list of quotes
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/quotes'

    order:
      description: order data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/order'

    orders:
      description: a list of orders
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/orders'

    activity:
      description: activity data for fetching
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/activity'

    activity_base:
      description: activity data for insert or update
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/activity_base'

    activities:
      description: a list of activities
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/activities'

    message:
      description: message data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/message'

    messages:
      description: a list of messages
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/messages'

    activity-contacts:
      description: a list of activity contact relations
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/activity-contacts'

    activity-contact:
      description: activity-contact-relation data for fetching
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/activity-contact'

    company-persons:
      description: a list of company person relations
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/company-persons'

    company-person:
      description: company-person-relation data for fetching
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/company-person'

    address-contacts:
      description: a list of address contact relations
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/address-contacts'

    address-contact:
      description: address-contact-relation data for fetching
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/address-contact'

    binary-access-token:
      description: token for accessing binary data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/binary-access-token'

    schema-list:
      description: a list of the schema for all entites
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/schema-list'

    error_authentication_failed:
      description: The authentication has failed
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/error_user_unknown'
              - $ref: '#/components/schemas/error_user_locked'

    error_invalid_id:
      description: The authenticated IAM user was not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error_invalid_id'

    error_invalid_data:
      description: The provided data was not valid
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: string
                example: 'invalid.data'
              error:
                type: string
                example: The provided data is invalid
              details:
                type: object
                properties:
                  field:
                    type: string
                    example: 'D07C1943E1929F83E030A8C0290112EB'

    error_record_not_found:
      description: The record was not found
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: string
                example: 'record.not_found'
              error:
                type: string
                example: 'The record was not found'
              details:
                type: object
                properties:
                  id:
                    type: string
                    example: 'XXX'

    error_missing_data:
      description: Not all necessary data was submitted by the client
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error_missing_data'

    error_data_validation_failed:
      description: The provided data failed a validation
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: string
                example: 'validation.failed'
              error:
                type: string
                example: The provided data failed a validation
              details:
                type: object
                properties:
                  cause:
                    type: string
                    example: data size too long for field!

  schemas:
    ########################################################################
    # objects
    ########################################################################
    object:
      type: object
      properties:
        _id:
          type: string
          description: identifier of the record
          example: F9BB0AAA22C947BAE030A8C00C015B91
  
    system_fields:
      type: object
      properties:
        updatedAt:
          type: string
          description: Date of the last update of this record
          example: 2024-10-15T09:47:44Z
        updatedBy:
            type: string
            description: contact id of the last person who has updated this record
            example: D1E9954702698E6BE030A8C029015B96
        createdAt:
          type: string
          description: Date when this record was created
          example: 2024-10-15T09:47:44Z
        createdBy:
          type: string
          description: contact id of the person who has created this record
          example: D1E9954702698E6BE030A8C029015B96

    contact:
      description: user object
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
      properties:
        name:
          type: string
          description: For a person the name consisting of given and family name. For a company the name.
          example: John Doe
        salutation:
          type: string
          description: identifier of the salutation of the person
          example: M
        givenName:
          type: string
          description: first name
          example: John
        familyName:
          type: string
          description: last name
          example: Doe
        email:
          type: string
          description: email address
          example: john.doe@acme.com
        position:
          type: string
          description: persons position inside of the organization
          example: Sales manager
        isPerson:
          type: boolean
          description: is the contact a person?
          example: true
        isExternal:
          type: boolean
          description: is the contact external?
          example: true
        entity:
          type: string
          description: Object type that corresponds to an endpoint (contact/person/company) for more data
          example: person
        image:
          description: Image of the user or the company logo
          $ref: '#/components/schemas/binary'
        thumbnail:
          type: string
          description: Thumbnail of the contact as a data URL encoded string
          example: data:image/png;base64,iVBORw0KGg...

    contacts:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/contact'

    whoami:
      type: object
      allOf:
        - $ref: '#/components/schemas/contact'

    contact_base:
      type: object
      properties:
        number:
          type: string
          description: The internal number of the contact
          example: C-20-000491
        status:
          type: string
          description: The identifier of the current status
          example: PSA_ORG_CST_PRC
        accountManager:
          type: string
          description: Id of the account manager
          example: 5150FF4BF8774C36A59D57FE47C38B58
        since:
          type: string
          description: Date when the first contact with this contact was made
          example: 2020-04-01T08:00:00Z
        occasion:
          type: string
          description: Occasion of the first contact
          example: DXD Digital Experience Days
        addresses:
          type: array
          description: List if address IDs
          example: ["43D937F0D5C9870EE040007F01007806","F5909F1CDC51A943E030A8C00C012134"]
          items:
            type: string
        phone:
          type: string
          description: Telephone number
          example: +49 30 23125641
        email:
          type: string
          description: Email address
          example: info@acme.org
        url:
          type: string
          description: Web site
          example: https://www.acme.org
        description:
          type: string
          description: Description of the contact
          example: Awesome company

    company_base:
      type: object
      allOf:
        - $ref: '#/components/schemas/contact_base'

    company:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/system_fields'
        - $ref: '#/components/schemas/company_base'
      properties:
        name:
          type: string
          description: The name of the company
          example: ACME Ltd.
        group:
          type: string
          description: The identifier of the group
          example: PSA_ORG_CST
        branch:
          type: string
          description: Name of the main branch the company
          example: Manufacture of chemicals and chemical products
        region:
          type: string
          description: Name of the region where the company is located
          example: North Germany
        isExternal:
          type: boolean
          description: is the contact external?
          example: true
        parents:
          type: array
          description: The list of parent companies. The first index is the top company.
          example: [DD0AB9752680C88BE030A8C029014E7E]
          items:
            type: string
        duplicateOf:
          type: string
          description: ID of a contact that is the master in case this contact is a duplicate
          example: 44AB4B88EBD34608B0E4A81C1DA1D85B
        image:
          description: Image or logo
          $ref: '#/components/schemas/binary'
        thumbnail:
          type: string
          description: Thumbnail of the contact as a data URL encoded string
          example: data:image/png;base64,iVBORw0KGg...

    companies:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/company'

    person_base:
      type: object
      allOf:
        - $ref: '#/components/schemas/contact_base'
      properties:
        salutation:
          type: string
          description: Salutation of the person
          example: M
        title:
          type: string
          description: Academic title
          example: PSA_DR
        givenName:
          type: string
          description: Given name
          example: John
        familyName:
          type: string
          description: Family name
          example: Doe
        additionalGivenName:
          type: string
          description: additional given name
          example: Jones
        nameSuffix:
          type: string
          description: Name suffix
          example: jr.

    person:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/system_fields'
        - $ref: '#/components/schemas/person_base'
      properties:
        name:
          type: string
          description: Composed name (given name + family name)
          example: John Doe
        group:
          type: string
          description: The identifier of the group
          example: PSA_PRS_CST
        isExternal:
          type: boolean
          description: is the contact external?
          example: true
        parents:
          type: array
          description: The list of parent companies. The first index is the top company.
          example: [DD0AB9752680C88BE030A8C029014E7E]
          items:
            type: string
        duplicateOf:
          type: string
          description: ID of a contact that is the master in case this contact is a duplicate
          example: 44AB4B88EBD34608B0E4A81C1DA1D85B
        image:
          description: Image or logo
          $ref: '#/components/schemas/binary'
        thumbnail:
          type: string
          description: Thumbnail of the contact as a data URL encoded string
          example: data:image/png;base64,iVBORw0KGg...

    persons:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/person'

    address_base:
      description: address object
      type: object
      properties:
        type:
          type: string
          description: address type
          example: MAIN_ADDRESS
        street:
          type: string
          description: Street and house number
          example: Bundesallee 1
        postalCode:
          type: string
          description: Postal code
          example: '14050'
        city:
          type: string
          description: City
          example: Berlin
        country:
          type: string
          description: Country identifier
          example: DEU

    address:
      description: address object
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/address_base'

    addresses:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/address'

    project_base:
      type: object
      properties:
        keyword:
          type: string
          description: Keyword of the project
          example: Filling line
        number:
          type: string
          description: Number of the project
          example: P-24-000615

    project:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/system_fields'
        - $ref: '#/components/schemas/project_base'
      properties:
        entity:
          type: string
          description: Object type that corresponds to an endpoint (e.g. project/opportunity/quote/order/ticket) for more data
          example: quote

    projects:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/project'

    ticket_base:
      type: object
      allOf:
        - $ref: '#/components/schemas/project_base'
      properties:
        type:
          type: string
          description: 'Type of the ticket'
          example: PSA_SVC_CAL
        status:
          type: string
          description: 'Status'
          example: PSA_SVC_CAL_ACQ
        open:
          type: boolean
          description: Is the ticket currently in an open status?
          example: true
        openSince:
          type: integer
          description: Number of days the ticket is open
          example: 15
        dueAt:
          type: string
          description: Date when the ticket should be closed
          example: 2024-12-11T15:46:34Z
        statusAt:
          type: string
          description: Date when the current status was set
          example: 2024-12-11T15:46:34Z
        description:
          type: string
          description: Description of the ticket/problem
          example: It is not working
        referenceNumber:
          type: string
          description: Customer reference number
          example: '#12345'
        responsibleAgent:
          type: string
          description: ID of the responsible person
          example: F0EC0D64556846A48D988781DEA397A0
        customer:
          type: string
          description: ID of the customer
          example: 8FDDFCC964044F189A09F7ACEA157F98
        submittedBy:
          type: string
          description: Free text who has submitted this ticket
          example: John Doe
        submittedAt:
          type: string
          description: Date when the ticket was submitted
          example: 2024-12-11T15:46:34Z
        origin:
          type: string
          description: Medium that was used to submit this ticket
          example: PSA_SVC_ORI_TYP_PRT        

    ticket:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/system_fields'
        - $ref: '#/components/schemas/ticket_base'

    tickets:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/ticket'

    salesproject:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/system_fields'
        - $ref: '#/components/schemas/project_base'
      properties:
        projectType:
          type: string
          description: Identifier of the sub type of the project
          example: PSA_QUO_STY_STD
        customer:
          type: string
          description: ID of the customer
          example: 52C3DFF6E44B45448CF8C2ECB55E3400
        commercialAgent:
          type: string
          description: ID of the commercial agent
          example: CD2B46B28C944FA2B5CE6BF3B5402E64
        technicalAgent:
          type: string
          description: ID of the technical agent
          example: F8635575DA604488981AECFB2B871ED5
        salesPartner:
          type: string
          description: ID of the sales partner for this project
          example: 191C336104A44A9484A045325D2DC21D
        status:
          type: string
          description: ID of the projects current status
          example: PSA_PRO_QUO_CPE
        mainStatus:
          type: string
          description: ID of the projects main status
          example: PSA_SAP_MAI_QUO_QUO_GEN
        open:
          type: boolean
          description: Is the project currently in an open status?
          example: true
        opportunityAt:
          type: string
          description: ISO formatted date string of the opportunity date
          example: 2024-07-17T12:00:45Z
        quoteAt:
          type: string
          description: ISO formatted date string of the quote date
          example: 2024-07-17T12:00:45Z
        orderAt:
          type: string
          description: ISO formatted date string of the order date
          example: 2024-07-17T12:00:45Z
        deliveryAt:
          type: string
          description: ISO formatted date string of the order delivery date
          example: 2024-07-17T12:00:45Z
        termsOfDelivery:
          type: string
          description: ID of the agreed terms of delivery
          example: RFC_TOD_CFR
        termsOfPayment:
          type: string
          description: ID the agreed terms of payment
          example: PSA_TOP_10
        totalPrice:
          type: number
          description: Total price of the project
          example: 100499
        totalPriceCurrency:
          type: string
          description: ISO 4217 code of the currency
          example: EUR
        statusInformation:
          type: string
          description: Status information
          example: Very promising
        description:
          type: string
          description: Description of the project
          example: New variant
        url:
          type: string
          description: URL of the project
          example: https://www.tynacoon.com

    opportunity:
      type: object
      allOf:
        - $ref: '#/components/schemas/salesproject'

    opportunities:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/opportunity'

    quote:
      type: object
      allOf:
        - $ref: '#/components/schemas/salesproject'
      properties:
        validUntil:
          type: string
          description: ISO formatted date string until when the quote is valid
          example: 2024-07-30T12:00:00Z

    quotes:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/quote'

    order:
      type: object
      allOf:
        - $ref: '#/components/schemas/salesproject'

    orders:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/order'

    activity_base:
      type: object
      properties:
        subject:
          type: string
          description: The subject of the activity
          example: Sales meeting
        beginAt:
          type: string
          description: ISO formatted date string of the starting time
          example: 2024-07-18T11:39:35Z
        endAt:
          type: string
          description: ISO formatted date string of the ending time
          example: 2024-07-18T11:39:35Z
        agent:
          type: string
          description: ID of the responsible person
          example: F6BB015098FA45DB959CE19E482B593F
        location:
          type: string
          description: Location of the activity/appointment
          example: Convention center
        status:
          type: string
          description: ID of the activity status
          example: PSA_STA_APM_AGR
        activitySubType:
            type: string
            description: ID of the activity sub type
            example: EVENT
        priority:
          type: string
          description: ID of the priority
          example: PSA_NRM
        note:
          type: string
          description: Notes made for the activity
          example: Strategy meeting for the next release
        classification:
          type: string
          description: ID of the main classification of the activity
          example: PSA_ACT_CLA_PRO_SAL
        additionalClassifications:
          type: array
          description: IDs of the additional classifications of the activity
          example: [PSA_ACT_CLA_CST_COM]
          items:
            type: string

    activity:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/system_fields'
        - $ref: '#/components/schemas/activity_base'
      properties:
        activityType:
          type: string
          description: ID of the activity type
          example: APPOINTMENT
        persons:
          type: array
          description: A list of IDs with the associated persons
          items:
            $ref: '#/components/schemas/activity-contact_contact'
        companies:
          type: array
          description: A list of IDs with the associated companies
          items:
            $ref: '#/components/schemas/activity-contact_contact'
        projects:
          type: array
          description: The list of projects this activity is related to. The first index is the main project.
          items:
            type: object
            properties:
              _id:
                type: string
                description: id of the relation
                example: 3FFA18DD83BF44F09DA1D863A67DEC90
              project: 
                type: string
                description: id of the project
                example: 045700FD66CD3BE9E040A8C00D015F8E

    activities:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/activity'

    message_base:
      type: object
      properties:
        subjectId:
          type: string
          description: reference to the project
          example: DDF8F474C125466DAB2A4937D5945E11
        text:
          type: string
          description: text of the message
          example: Hello world
        public:
          type: boolean
          description: Is this message visible to everyone?
          example: false
          
    message:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/message_base'
      properties:
        createdAt:
          type: string
          description: Date when this message was created
          example: 2024-12-17T13:41:19Z
        createdBy:
          type: string
          description: contact id of the person who has created this contact
          example: 
        attachments:
          type: array
          description: Files that were attached to this message
          items:
            $ref: '#/components/schemas/binary'

    message_post:
      type: object
      allOf:
        - $ref: '#/components/schemas/message_base'
      properties:
        attachments:
          type: array
          description: Files to attach to this message
          items:
            $ref: '#/components/schemas/binary-upload'

    messages:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/message'

    activity-contacts:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/activity-contact'

    activity-contact:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/activity-contact_base'

    activity-contact_base:
      type: object
      properties:
        activity:
          type: string
          description: ID of the associated activity
          example: 8830238D81214394A18D65DFEE655ADB
        contact:
          type: string
          description: ID of the associated contact
          example: 862166B3FFEE4D30B45B4EC63FFEE78B

    activity-contact_contact:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
      properties:
        contact:
          type: string
          description: ID of the associated contact
          example: 862166B3FFEE4D30B45B4EC63FFEE78B

    company-persons:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/company-person'

    company-person:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/company-person_base'

    company-person_base:
      type: object
      properties:
        company:
          type: string
          description: ID of the associated company
          example: 8830238D81214394A18D65DFEE655ADB
        person:
          type: string
          description: ID of the associated person
          example: 862166B3FFEE4D30B45B4EC63FFEE78B

    company-person_company:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
      properties:
        company:
          type: string
          description: ID of the associated company
          example: 862166B3FFEE4D30B45B4EC63FFEE78B

    address-contacts:
      type: object
      properties:
        continuation:
          type: string
          description: key that is used to fetch the next result page
        count:
          type: integer
          description: the total number of results
          example: 1
        results:
          type: array
          items:
            $ref: '#/components/schemas/address-contact'

    address-contact:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
        - $ref: '#/components/schemas/address-contact_base'

    address-contact_base:
      type: object
      properties:
        address:
          type: string
          description: ID of the associated address
          example: C249361A232A4E8F859A13593B9D6440
        contact:
          type: string
          description: ID of the associated contact
          example: 21F28013E5A24B85BEEF56C8A2423898

    binary-access-token:
      type: object
      properties:
        accessToken:
          type: string
          description: URL for accessing the binary data
          example: /binary-access/1649cff06611a6025da3dd511a97fb4328ABC5BC362145C0A6F308F116C6A7A5
        maxAge:
          type: integer
          description: time in seconds how long the token is valid
          example: 3600

    schema-list:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/schema'

    schema:
      type: object
      allOf:
        - $ref: '#/components/schemas/object'
      properties:
        name:
          type: string
          description: The name of the group
          example: company
        general:
          type: object
          properties:
            title:
              type: string
              example: Organization
            icon: 
              type: string
              example: ''
            groupOrder:
              type: array
              example: ["base", "additional"]
              items:
                type: string
        groups:
          type: object
          additionalProperties:
            type: object
            properties:
              title:
                type: string
                example: Base data
              attributeOrder:
                type: array
                example: ["name", "email"]
                items:
                  type: string
        attributes:
          type: object
          additionalProperties:
            type: object
            properties:
              type:
                type: string
                example: string
              referenceTo:
                type: string
                example: Company
              enumValues:
                type: array
                items:
                  type: object
                  properties:
                    value:
                      type: string
                      example: IDENTIFIER_001
                    title: 
                      type: string
                      example: Value 1
                    constraints:
                      type: object
                      additionalProperties:
                        type: array
                        items:
                          type: string
              referenceFilter:
                  type: object
                  description: attributes and the query to be used when listing elements of the referenced object
                  additionalProperties:
                    type: string
              hidden:
                type: boolean
                example: false
              maxLength:
                type: integer
                example: 32
              mandatory:
                type: boolean
                example: false
              readonly:
                type: boolean
                example: false

    binary:
      type: object
      properties:
        _id:
          type: string
          description: Identifier that is used to request a binary access token
          example: c231fa48df3ee393c92dccac4dba5e7dE308ED22299D449C97DB6B7642FA2CA9
        filename:
          type: string
          description: filename
          example: screenshot1.jpg
        contentType:
          type: string
          description: MIME type
          example: image/jpg
        contentLength:
          type: integer
          description: estimated size of the binary data in bytes
          example: 245120

    binary-upload:
      type: object
      properties:
        filename:
          type: string
          description: file name of the uploaded binary data
          example: text.txt
        dataBase64:
          type: string
          description: Base64 encoded data
          example: SGVsbG8gd29ybGQ=

    ########################################################################
    # errors
    ########################################################################

    error_user_unknown:
      description: The authenticated IAM user was not found
      type: object
      properties:
        code:
          type: string
          example: 'user.unknown'
        error:
          type: string
          example: 'The user was not found'
        details:
          type: object
          properties:
            email:
              type: string
              example: 'john.doe@acme.org'

    error_user_locked:
      description: The authenticated IAM user is not allowed to login because the contact is locked
      type: object
      properties:
        code:
          type: string
          example: 'user.locked'
        error:
          type: string
          example: 'The user is locked'
        details:
          type: object
          properties:
            email:
              type: string
              example: 'john.doe@acme.org'
            status:
              type: string
              description: identifier of the current status
              example: PSA_PRS_LEA_BLC

    error_invalid_id:
      description: The authenticated IAM user was not found
      type: object
      properties:
        code:
          type: string
          example: 'invalid.id'
        error:
          type: string
          example: 'The ID is invalid'
        details:
          type: object
          properties:
            id:
              type: string
              example: 'XXX'

    error_missing_data:
      description: Not all necessary data was submitted by the client
      type: object
      properties:
        code:
          type: string
          example: 'missing.data'
        error:
          type: string
          example: 'Some data is missing'
        details:
          type: object
          properties:
            field:
              type: string
              description: name of the missing field
              example: 'title'
